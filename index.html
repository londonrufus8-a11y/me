<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Accessories Store</title>

<style>
body{font-family:Arial;margin:0;background:#f4f4f4}
header{background:#0f172a;color:white;padding:15px;text-align:center}
.controls{display:flex;gap:10px;justify-content:center;padding:10px;flex-wrap:wrap}
input,select{padding:8px;width:200px;max-width:90%}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;padding:15px}
.card{background:white;padding:10px;border-radius:6px;display:flex;flex-direction:column;align-items:center}
.card img{width:100%;height:170px;object-fit:cover;border-radius:6px}
.price{color:green;font-weight:bold;margin:5px 0}
button{border:none;padding:8px;border-radius:5px;cursor:pointer}
.add{background:#2563eb;color:white;width:100%;margin-top:auto}

/* MINI CART */
.mini-cart{
 position:fixed;bottom:15px;right:15px;
 background:#22c55e;color:white;padding:10px 15px;
 border-radius:50px;cursor:pointer;font-weight:bold;
 display:flex;align-items:center;gap:10px;z-index:1000;
}
.mini-cart span{background:red;color:white;border-radius:50%;padding:3px 7px;font-size:12px}

/* MINI PREVIEW WITH IMAGES */
.mini-preview{
 display:none;
 position:absolute;bottom:50px;right:0;
 width:320px;
 background:white;
 color:black;
 border-radius:6px;
 padding:10px;
 box-shadow:0 2px 10px rgba(0,0,0,0.2);
 z-index:1001;
 max-height:400px;
 overflow-y:auto;
}
.mini-preview .preview-item{display:flex;align-items:center;gap:10px;margin-bottom:5px}
.mini-preview img{width:40px;height:40px;object-fit:cover;border-radius:4px}
.mini-cart:hover .mini-preview{display:block}

/* FULL CART PANEL */
.cart{
 position:fixed;top:0;right:0;width:350px;height:100%;
 background:white;padding:15px;
 display:none;box-shadow:-2px 0 5px rgba(0,0,0,.2);
 overflow-y:auto;z-index:999;
}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.close-cart{background:#dc2626;color:white;padding:5px 10px;border-radius:5px;cursor:pointer;font-weight:bold}
.cart-item{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.cart-item img{width:50px;height:50px;object-fit:cover;border-radius:4px}
.cart-item-details{flex:1;display:flex;flex-direction:column}
.remove{background:red;color:white;font-size:12px;padding:3px 5px;border-radius:3px;margin-top:5px}
.subtotal{color:green;font-weight:bold}
.low-stock{color:#dc2626;font-weight:bold}

/* CLEAR & CHECKOUT */
.clear{background:black;color:white;width:100%;margin-top:5px}
.checkout{background:#22c55e;color:white;width:100%;margin-top:5px}

/* RESPONSIVE */
@media(max-width:600px){
 .mini-preview{width:90vw;right:5px;bottom:60px;max-height:300px}
 .cart{width:90vw}
 .controls{flex-direction:column;align-items:center}
 input,select{width:90%}
}
</style>
</head>

<body>

<header>
  <h2>Computer & Phone Accessories</h2>
  <p>Order via WhatsApp</p>
</header>

<div class="controls">
  <input id="search" placeholder="Search product">
  <select id="filter">
    <option value="">All Categories</option>
    <option value="Computer">Computer</option>
    <option value="Phone">Phone</option>
  </select>
</div>

<div class="products" id="products"></div>

<!-- MINI CART -->
<div class="mini-cart" onclick="toggleCart()">
 ðŸ›’ <span id="count">0</span> | â‚¦<span id="miniTotal">0</span>
 <div class="mini-preview" id="miniPreview"></div>
</div>

<!-- FULL CART PANEL -->
<div class="cart" id="cart">
  <div class="cart-header">
    <h3>Cart</h3>
    <div class="close-cart" onclick="toggleCart()">âœ– Close</div>
  </div>
  <div id="cartItems"></div>
  <p><b>Total: â‚¦<span id="total">0</span></b></p>
  <p><small>Order Ref: <b id="ref"></b></small></p>
  <button class="clear" onclick="clearCart()">Clear Cart</button>
  <button class="checkout" onclick="checkout()">Checkout WhatsApp</button>
</div>

<script>
const csvFile="products.csv";
const phone="2348012345678"; // CHANGE TO YOUR NUMBER
let products=[];
let cart=JSON.parse(localStorage.getItem("cart"))||[];

function genRef(){ return "ORD-"+Date.now().toString().slice(-6); }
document.getElementById("ref").textContent=genRef();

function toggleCart(){
 let c=document.getElementById("cart");
 c.style.display=c.style.display==="block"?"none":"block";
}

function saveCart(){
 localStorage.setItem("cart",JSON.stringify(cart));
 renderCart();
 renderMiniPreview();
}

function addToCart(name,price,qty,img,stock){
 let existing = cart.find(i=>i.name===name);
 if(existing){
   if(existing.qty+qty>stock) existing.qty=stock;
   else existing.qty += qty;
 } else {
   if(qty>stock) qty=stock;
   cart.push({name,price,qty,img,stock});
 }
 saveCart();
}

function removeItem(i){ cart.splice(i,1); saveCart(); }
function clearCart(){ cart=[]; saveCart(); }

function renderCart(){
 let box=document.getElementById("cartItems");
 let totalBox=document.getElementById("total");
 let miniTotalBox=document.getElementById("miniTotal");
 let count=document.getElementById("count");
 box.innerHTML="";
 let total=0, items=0;

 cart.forEach((i,idx)=>{
  total+=i.price*i.qty;
  items+=i.qty;
  let lowStock=i.stock<=5?"<span class='low-stock'>Low Stock!</span>":"";
  box.innerHTML+=`
   <div class="cart-item">
     <img src="${i.img}">
     <div class="cart-item-details">
       <span>${i.name} x${i.qty}</span>
       <span class="subtotal">â‚¦${i.price*i.qty}</span>
       ${lowStock}
     </div>
     <button class="remove" onclick="removeItem(${idx})">X</button>
   </div>`;
 });

 totalBox.textContent=total;
 miniTotalBox.textContent=total;
 count.textContent=items;
}

function renderMiniPreview(){
 let preview=document.getElementById("miniPreview");
 preview.innerHTML="";
 if(cart.length===0){
   preview.innerHTML="<p>Cart is empty</p>";
   return;
 }
 cart.forEach(i=>{
   preview.innerHTML+=`
    <div class="preview-item">
      <img src="${i.img}">
      <div>${i.name} x${i.qty} - â‚¦${i.price*i.qty}</div>
    </div>`;
 });
}

function checkout(){
 if(!cart.length)return alert("Cart empty");
 let ref=document.getElementById("ref").textContent;
 let msg=`Order Ref: ${ref}%0A`;
 let total=0;
 cart.forEach(i=>{
  msg+=`- ${i.name} x${i.qty} â‚¦${i.price*i.qty}%0A`;
  total+=i.price*i.qty;
 });
 msg+=`Total: â‚¦${total}`;
 window.open(`https://wa.me/${phone}?text=${msg}`,"_blank");
}

function display(){
 let s=document.getElementById("search").value.toLowerCase();
 let f=document.getElementById("filter").value;
 let box=document.getElementById("products");
 box.innerHTML="";
 products.filter(p=>
  (!f||p.cat===f) && p.name.toLowerCase().includes(s)
 ).forEach(p=>{
  box.innerHTML+=`
   <div class="card">
    <img src="${p.img}">
    <h4>${p.name}</h4>
    <p>${p.desc}</p>
    <p class="price">â‚¦${p.price}</p>
    Qty: <input type="number" class="qty" min="1" max="${p.stock}" value="1" id="q${p.id}">
    <button class="add" onclick="addToCart('${p.name}',${p.price},Number(q${p.id}.value),'${p.img}',${p.stock})">
      Add to Cart
    </button>
   </div>`;
 });
}

fetch(csvFile)
.then(r=>r.text())
.then(d=>{
 d.split("\n").slice(1).forEach(r=>{
  let c=r.split(",");
  if(c.length<8)return;
  products.push({
   id:c[0],name:c[1],cat:c[2],
   price:Number(c[4]),stock:Number(c[5]),
   img:c[6],desc:c[7]
  });
 });
 display();
});

document.getElementById("search").oninput=display;
document.getElementById("filter").onchange=display;
renderCart();
</script>

</body>
</html>
